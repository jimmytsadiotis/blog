---
layout: post
title: Enforcing Dependency License Compliance Across Multiple Repositories
description: Exploring solutions to prevent the introduction of dependencies with unsuitable licenses across a large number of GitHub repositories.
summary: This post discusses the challenge of enforcing dependency license compliance in a large organization with numerous repositories and evaluates potential solutions like GitHub's dependency-review-action and FOSSA.
tags: github, devops, security, dependencies, licenses, automation
minute: 5
---

# Enforcing Dependency License Compliance Across Multiple Repositories

## Problem

We face the challenge of preventing the introduction of dependencies with unsuitable licenses into our GitHub repositories. Currently, we rely on custom scripts tailored to each repository's language, which presents several drawbacks:

* **Manual Deployment:** We have 264 repositories, requiring manual implementation of these scripts in each one.
* **Language Dependency:** Scripts must be adapted for each repository's specific programming language.

We need a centralized, scalable solution to enforce license compliance.

I found these resources:

* [Perplexity AI Search](https://www.perplexity.ai/search/Do-github-has-NLKrsmF4QnC4lRwWLxUL1A)
* [GitHub's dependency-review-action](https://github.com/actions/dependency-review-action)

Enforcing the `dependency-review-action` in every repository appears to be a viable solution.

## Solution

We explored two potential solutions: GitHub's `dependency-review-action` and FOSSA.

### `dependency-review-action`

* This GitHub Action seems suitable for our purpose and is relatively easy to integrate.
* However, it's important to note that:
    * "Dependency review is available in all public repositories in all products and cannot be disabled."
    * "Dependency review is available in private repositories owned by organizations that use GitHub Enterprise Cloud and have a license for GitHub Advanced Security. For more information, see the GitHub Enterprise Cloud documentation."

### FOSSA

* FOSSA's CLI tool also addresses our needs.
* However, it requires purchasing additional licenses for each contributor.
* To demonstrate its functionality, I created a test repository: [demetristsadiotis/django.nv/](https://github.com/demetristsadiotis/django.nv/). You can review the latest GitHub Action in this repository.
* FOSSA also provides the ability to configure "cicd checks" from its project dashboard.

Here is the .github/workflows/main.yaml from the testing repo:

```yaml
name: Django

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Setup python
        uses: actions/setup-python@v2
        with:
          python-version: '3.6'
      - run: |
          pip3 install --upgrade virtualenv
          virtualenv env
          source env/bin/activate
          pip install -r requirements.txt
          python manage.py check

  test:
    runs-on: ubuntu-20.04
    needs: build
    steps:
      - uses: actions/checkout@v2
      - name: Setup python
        uses: actions/setup-python@v2
        with:
          python-version: '3.6'
      - run: |
          pip3 install --upgrade virtualenv
          virtualenv env
          source env/bin/activate
          pip install -r requirements.txt
          python manage.py test taskManager

  oast:
    runs-on: ubuntu-20.04
    needs: test
    steps:
      - uses: actions/checkout@v2
      - run: docker run --rm -v $(pwd):/src hysnsec/safety check -r requirements.txt --json > oast-results.json
        continue-on-error: true
      - uses: actions/upload-artifact@v2
        with:
          name: Safety
          path: oast-results.json
        if: always()

  fossa:
    runs-on: ubuntu-20.04
    needs: oast
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Install FOSSA
        run: |
          curl -H 'Cache-Control: no-cache' [https://raw.githubusercontent.com/fossas/fossa-cli/master/install-latest.sh](https://raw.githubusercontent.com/fossas/fossa-cli/master/install-latest.sh) | bash
      - name: Set FOSSA API Key
        env:
          FOSSA_API_KEY: <span class="math-inline">\{\{ secrets\.FOSSA\_API\_KEY \}\}
run\: echo "FOSSA\_API\_KEY\=</span>{FOSSA_API_KEY}" >> $GITHUB_ENV
      - name: Run FOSSA Analysis
        run: fossa analyze
      - name: Run FOSSA Test
        run: fossa test

  integration:
    runs-on: ubuntu-20.04
    needs: oast
    steps:
      - run: echo "This is an integration step"
      - run: exit 1
        continue-on-error: true

  prod:
    runs-on: ubuntu-20.04
    needs: integration
    steps:
      - run: echo "This is a deploy step."